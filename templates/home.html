{% extends 'base.html' %}
{% block content %}

<!-- Search bar -->
<div class="row card-panel grey lighten-5">
	<form action="{{ url_for('search') }}" method="post" class="col s12">
		<div class="row valign-wrapper center-align">
			<div class="input-field col s12 m8">
				<input type="text" name="search" id="search" minlength="5" class="validate" required>
				<label for="search">Search Post</label>
			</div>
			<div class="col s12 m4">
				<a href="{{ url_for('home') }}" class="red btn text-shadow">Reset</a>
				<button type="submit" class="light-blue darken-1 btn text-shadow">
                        <i class="fas fa-search left"></i> Search
                    </button>
			</div>
		</div>
	</form>
</div>

{% if posts|length > 0 %}
{% for post in posts|reverse %}

<!-- Card to display blog post on Mobile -->
<div class="row ">
	<div class="col s12 ">
		<div class="hide-on-med-and-up">
			<div class="card">
				<!-- Post image -->
				<div class="card-image">
					<a href="{{ url_for('view_post', post_id=post._id) }}"><img src="{{post.post_image}}"></a>
				</div>
				<!-- Post content -->
				<div class="card-content">
					<a href="{{ url_for('view_post', post_id=post._id) }}">
						<h2 class="post-heading"> {{post.post_title}}</h2>
						<p>By {{post.created_by}} - {{post.created_at}}</p>
						<p>Read Time: {{post.read_time}}</p>
					</a>
				</div>
				<!-- Delete and Edit post buttons only viewable to logged in users -->
				<div class="card-action">
					{% if session.user|lower == post.created_by|lower %}
					<button data-target="modal1" class="btn red modal-trigger">Delete</button>
					<a href="{{ url_for('edit_post', post_id=post._id) }}" class="btn light-blue lighten-1">Edit</a>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Card to display blog post on Tablet and Desktop  -->
<div class="row ">
	<div class="col m12 l12">
		<div class="hide-on-small-only">

			<div class="card horizontal">
				<!-- Post image -->
				<div class="card-image">
					<a href="{{ url_for('view_post', post_id=post._id) }}"><img src="{{post.post_image}}"> </a>
				</div>
				<div class="card-stacked">
					<!-- Post content -->
					<div class="card-content">
						<a href="{{ url_for('view_post', post_id=post._id) }}">
							<h2 class="post-heading"> {{post.post_title}}</h2>
							<p>by {{post.created_by}} - {{post.created_at}}</p>
							<p>Read Time: {{post.read_time}}</p>
						</a>
					</div>
					<!-- Delete and Edit post buttons only viewable to logged in users -->
					<div class="card-action">
						{% if session.user|lower == post.created_by|lower %}
						<button data-target="modal1" class="btn red modal-trigger">Delete</button>
						<a href="{{ url_for('edit_post', post_id=post._id) }}" class="btn light-blue lighten-1">Edit</a>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal Structure -->
	<div id="modal1" class="modal">
		<div class="modal-content">
			<h4 class="modal-heading">Delete Post</h4>
			<p>Are you sure you want to delete this post?</p>
		</div>
		<div class="modal-footer">
			<button  class="btn modal-close">Cancel</button>
			<a href="{{ url_for('delete_post', post_id=post._id) }}"
				class="btn red modal-close waves-effect waves-green btn-flat">Delete</a>
		</div>
	</div>

	{% endfor %}
	{% else %}
	<h3 class="red-text center-align">No Results Found</h3>
	{% endif %}

	{% endblock %}